require 'httparty'
require 'json'
require 'dotenv'
Dotenv.load

# 取得したYelp Fusion APIのAPIキーに置き換えてください
API_KEY = ENV["YELP_API_KEY"]
puts API_KEY
url = "https://api.yelp.com/v3/businesses/search"

# 検索パラメータの設定
params = {
  term: "cafe",
  location: "San Francisco, CA",
  radius: 500,    # 半径0.5km = 500メートル
  limit: 10
}

# リクエストヘッダーに認証情報を追加
headers = {
  "Authorization" => "Bearer #{API_KEY}"
}

# GETリクエストを送信
response = HTTParty.get(url, query: params, headers: headers)

if response.code == 200
  result = JSON.parse(response.body)
  businesses = result["businesses"]
  if businesses
    businesses.each do |business|
      puts business["name"]
    end
  else
    puts "ビジネス情報が取得できませんでした。"
  end
else
  puts "エラーが発生しました: #{response.code}"
  puts response.body
end
